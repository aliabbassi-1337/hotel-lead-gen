# Workflow definitions and schedules for Sadie GTM
#
# Pipeline: Scrape → Enqueue → Detect (EC2) → Enrich → Launch → Export
#
# Status values:
#   -2 = location_mismatch (rejected)
#   -1 = no_booking_engine (rejected)
#    0 = pending (in pipeline)
#    1 = launched (live lead)

workflows:
  # === SCRAPING ===
  scraper:
    description: Scrape hotels from Serper for a region
    command: uv run python workflows/scrape_region.py
    enabled: false  # On-demand only (run manually)

  # === DETECTION PIPELINE ===
  enqueue_detection:
    description: Queue scraped hotels to SQS for detection workers
    command: uv run python workflows/enqueue_detection.py --limit 500
    schedule: "*/30 * * * *"  # Every 30 minutes
    enabled: true

  # detection_consumer runs continuously on EC2, not as a cron job
  # Command: uv run python workflows/detection_consumer.py --concurrency 6

  # === ENRICHMENT ===
  enrichment_room_counts:
    description: Enrich hotels with room counts via Groq LLM
    command: uv run python workflows/enrichment.py room-counts --limit 100
    schedule: "10,40 * * * *"  # At :10 and :40 past each hour
    enabled: true

  enrichment_proximity:
    description: Calculate nearest existing customer distance (PostGIS)
    command: uv run python workflows/enrichment.py proximity --limit 200
    schedule: "*/15 * * * *"  # Every 15 minutes
    enabled: true

  # === LAUNCH ===
  launcher:
    description: Launch fully enriched hotels (mark as live, status=1)
    command: uv run python workflows/launcher.py launch-all
    schedule: "*/10 * * * *"  # Every 10 minutes
    enabled: true

  # === EXPORT ===
  export:
    description: Export leads to Excel and upload to S3
    command: uv run python workflows/export.py --all-states
    enabled: false  # TODO: Add Slack slash command integration
